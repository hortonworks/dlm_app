<dlm-table
  #jobsTable
  [showPageSizeMenu]="showPageSizeMenu"
  [columns]="columns"
  [rows]="jobs"
  (selectColumnAction)="handleSelectedAction($event)">
</dlm-table>

<dlm-icon-column [showHexagon]="false" [showValue]="true"></dlm-icon-column>
<dlm-status-column [showText]="false"></dlm-status-column>

<ng-template #statusCellTemplate let-row="row">
  <dlm-job-status [job]="row"></dlm-job-status>
</ng-template>

<ng-template #verbStatusCellTemplate let-value="value">
  {{value | policyStatusFmt}}
</ng-template>

<ng-template #agoTemplate let-value="value" let-policy="row">
  <span *ngIf="policy.lastJobResource">
    <span *ngIf="value; else" [tooltip]="value | fmtTz | amDateFormat:'YYYY-MMM-DD, HH:mm:ss'">
      {{value | fmtTz | amTimeAgo}}
    </span>
    <ng-template #inProgress>
      In Progress
    </ng-template>
  </span>
</ng-template>

<ng-template #prevJobs let-row="row">
  <dlm-prev-jobs class="actionable" (click)="goToPolicy(row)" [policy]="row"></dlm-prev-jobs>
</ng-template>

<ng-template #nextRunTemplate let-row="row">
  <span [tooltip]="row.nextRun | fmtTz | amDateFormat:'YYYY-MMM-DD, HH:mm:ss'">
    {{row.nextRun | fmtTz | amDateFormat:'MMM DD, YYYY'}}
  </span>
</ng-template>

<ng-template #runTimeTemplate let-value="value" let-policy="row">
  <dlm-duration-column [isRunning]="isRunning(policy?.lastJobResource)" [duration]="value"></dlm-duration-column>
</ng-template>

<ng-template #transferredFormattedTemplate let-value="value" let-policy="row">
  <span *ngIf="value >= 0 && !isRunning(policy?.lastJobResource)" [innerHTML]="value | bytesSize"></span>
  <!-- @TODO: this is mock -->
  <!-- <progressbar *ngIf="isRunning(policy?.lastJobResource)" [value]="progress$ | async" [max]="15"></progressbar> -->
  <i *ngIf="value === undefined" class="fa fa-minus"></i>
</ng-template>

<ng-template #destinationIconCell>
  <i class="fa fa-arrow-right"></i>
</ng-template>

<ng-template #actionsCell let-row="row">
  <dlm-policy-actions
    [rowId]="row.id"
    [policy]="row"
    [isOpen]="shouldShowAction(row.id)"
    [policyActions]="rowActions"
    (openChange)="handleActionOpenChange($event)"
    (handler)="handleSelectedAction($event)"></dlm-policy-actions>
</ng-template>

<dlm-modal-dialog
  [title]="'page.policies.perform_action.confirmation.title'"
  [body]="'page.policies.perform_action.confirmation.body'"
  [showDialog]="showActionConfirmationModal"
  (onClose)="onCloseActionConfirmationModal()"
  (onOk)="onActionConfirmation()">
</dlm-modal-dialog>

<dlm-modal-dialog
  [title]="lastOperationResponse.status"
  [body]="lastOperationResponse.message"
  [showDialog]="showOperationResponseModal"
  [showCancel]="false"
  (onClose)="onCloseOperationResponseModal()">
</dlm-modal-dialog>
