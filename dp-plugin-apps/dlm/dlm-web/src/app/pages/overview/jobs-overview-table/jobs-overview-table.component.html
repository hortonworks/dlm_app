<dlm-table
  #jobsTable
  [showPageSizeMenu]="showPageSizeMenu"
  [columns]="columns"
  [rows]="jobs"
  (selectColumnAction)="handleSelectedAction($event)">
</dlm-table>

<dlm-icon-column [showHexagon]="false" [showValue]="true"></dlm-icon-column>
<dlm-status-column [showText]="false"></dlm-status-column>

<ng-template #statusCellTemplate let-policy="row">
  <dlm-job-status
    class="actionable"
    [job]="policy.lastJobResource"
    [tooltip]="policy.lastJobResource.status !== JOB_STATUS.RUNNING ? ('page.notifications.view_log' | translate) : ''"
    (click)="showPolicyLog(policy)">
  </dlm-job-status>
</ng-template>

<ng-template #verbStatusCellTemplate let-job="value" let-policy="row">
  <dlm-transferred-column
    *ngIf="job.status === JOB_STATUS.RUNNING && job.trackingInfo?.completedMapTasks; else verbTpl"
    [trackingInfo]="job.trackingInfo">
  </dlm-transferred-column>
  <ng-template #verbTpl>
    <span class="actionable" [tooltip]="'page.notifications.view_log' | translate" (click)="showPolicyLog(policy)">
      {{job.status}}
      <i class="fa fa-file-text-o text-info"></i>
    </span>
  </ng-template>
</ng-template>

<ng-template #policyNameCellTemplate let-row="row" let-name="value">
  <a (click)="goToPolicy(row)" class="actionable">
   {{name}}
  </a>
</ng-template>

<ng-template #agoTemplate let-value="value" let-policy="row">
  <span *ngIf="policy.lastJobResource">
    <span *ngIf="value; else" [tooltip]="value | fmtTz | amDateFormat:'YYYY-MMM-DD, HH:mm:ss'">
      {{value | fmtTz | amTimeAgo}}
    </span>
    <ng-template #inProgress>
      {{'common.status.in_progress' | translate}}
    </ng-template>
  </span>
</ng-template>

<ng-template #prevJobs let-jobs="value" let-row="row">
  <dlm-last-ten-jobs-column class="actionable" (click)="goToPolicy(row)" [jobs]="jobs"></dlm-last-ten-jobs-column>
</ng-template>

<ng-template #nextRunTemplate let-row="row">
  <span [tooltip]="row.nextRun | fmtTz | amDateFormat:'YYYY-MMM-DD, HH:mm:ss'">
    {{row.nextRun | fmtTz | amDateFormat:'MMM DD, YYYY'}}
  </span>
</ng-template>

<ng-template #runTimeTemplate let-value="value" let-policy="row">
  <dlm-duration-column [isRunning]="isRunning(policy?.lastJobResource)" [duration]="value"></dlm-duration-column>
</ng-template>

<ng-template #transferredFormattedTemplate let-value="value" let-policy="row">
  <div *ngIf="policy.lastJobResource.status === JOB_STATUS.RUNNING; else transferredTpl" class="text-muted text-uppercase">
    {{'common.status.in_progress' | translate}}
  </div>
  <ng-template #transferredTpl>
    <span [innerHtml]="value.bytesCopied | bytesSize"></span>
    <span *ngIf="value.filesCopied">/ {{value.filesCopied}}</span>
  </ng-template>
</ng-template>

<ng-template #destinationIconCell>
  <i class="fa fa-arrow-right"></i>
</ng-template>

<ng-template #actionsCell let-row="row">
  <dlm-policy-actions
    [rowId]="row.id"
    [policy]="row"
    [isOpen]="shouldShowAction(row.id)"
    [policyActions]="rowActions"
    (openChange)="handleActionOpenChange($event)"
    (handler)="handleSelectedAction($event)">
  </dlm-policy-actions>
</ng-template>

<dlm-modal-dialog
  [title]="'page.policies.perform_action.confirmation.title'"
  [body]="'page.policies.perform_action.confirmation.body'"
  [showDialog]="showActionConfirmationModal"
  (onClose)="onCloseActionConfirmationModal()"
  (onOk)="onActionConfirmation()">
</dlm-modal-dialog>

<dlm-modal-dialog
  [title]="lastOperationResponse.status"
  [body]="lastOperationResponse.message"
  [showDialog]="showOperationResponseModal"
  [showCancel]="false"
  (onClose)="onCloseOperationResponseModal()">
</dlm-modal-dialog>
