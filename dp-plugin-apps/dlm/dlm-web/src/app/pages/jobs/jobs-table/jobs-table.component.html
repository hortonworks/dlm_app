<!--
  ~ Copyright  (c) 2016-2017, Hortonworks Inc.  All rights reserved.
  ~
  ~ Except as expressly permitted in a written agreement between you or your company
  ~ and Hortonworks, Inc. or an authorized affiliate or partner thereof, any use,
  ~ reproduction, modification, redistribution, sharing, lending or other exploitation
  ~ of all or any part of the contents of this software is strictly prohibited.
  -->

<dlm-table
  #jobsTable
  [sorts]="sorts"
  [offset]="page"
  [showPageSizeMenu]="showPageSizeMenu"
  [columns]="columns"
  [rows]="jobs"
  [selectionType]="selectionType"
  (sortAction)="handleOnSort($event)"
  (pageChange)="handlePageChange($event)"
  selectionType="checkbox">
</dlm-table>

<dlm-icon-column [showHexagon]="false" [showValue]="true"></dlm-icon-column>

<ng-template #statusCellTemplate let-row="row">
  <dlm-job-status [job]="row"></dlm-job-status>
</ng-template>

<ng-template #statusVerbTemplate let-value="value">
  <span *ngIf="value === JOB_STATUS.IGNORED; else notIgnored" [tooltip]="'page.jobs.job_ignored' | translate">
    {{value | statusFmt}}
  </span>

  <ng-template #notIgnored>
    {{value | statusFmt}}
  </ng-template>
</ng-template>

<ng-template #agoTemplate let-value="value">
  <span *ngIf="policy.lastJobResource">
    <span *ngIf="value; else" [tooltip]="value | fmtTz | amDateFormat:'YYYY-MMM-DD, HH:mm:ss'">
      {{value | fmtTz | amTimeAgo}}
    </span>
    <ng-template #inProgress>
      In Progress
    </ng-template>
  </span>
</ng-template>

<ng-template #runTimeTemplate let-value="value" let-row="row">
  <dlm-duration-column [isRunning]="isRunning(row)" [duration]="value"></dlm-duration-column>
</ng-template>

<ng-template #transferredFormattedTemplate let-value="value" let-job="row">
  <dlm-transferred-column [trackingInfo]="value" [jobStatus]="job.status"></dlm-transferred-column>
</ng-template>

<ng-template #actionsCell let-row="row">
  <dlm-policy-actions
    qe-attr="job-actions"
    [rowId]="row.id"
    [policy]="row"
    [isOpen]="shouldShowAction(row.id)"
    [policyActions]="rowActions"
    (openChange)="handleActionOpenChange($event)"
    (handler)="handleSelectedAction($event)">
  </dlm-policy-actions>
</ng-template>
