<!--
  ~ Copyright  (c) 2016-2017, Hortonworks Inc.  All rights reserved.
  ~
  ~ Except as expressly permitted in a written agreement between you or your company
  ~ and Hortonworks, Inc. or an authorized affiliate or partner thereof, any use,
  ~ reproduction, modification, redistribution, sharing, lending or other exploitation
  ~ of all or any part of the contents of this software is strictly prohibited.
  -->

<div class="form-container">
  <form class="basic-form add-cloud-form" [formGroup]="addCloudForm">
    <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12">
          <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
            {{errorMessage}}
          </div>
        </div>
        <div class="form-section col-xs-12">
          <dlm-form-field
            [label]="'page.cloud_stores.content.accounts.add.provider' | translate"
            [fieldClass]="fieldClass"
            [errorClass]="fieldClass">
            <dlm-select-field qe-attr="add-cloud-store-cloud-provider-type" formField formControlName="cloudProviderType"
                              [options]="cloudProviderOptions" [value]="cloudProviderType">
            </dlm-select-field>
          </dlm-form-field>
          <dlm-form-field
            [label]="'page.cloud_stores.content.accounts.add.name.label' | translate"
            [inlineError]="true"
            [fieldClass]="fieldClass"
            [errorClass]="fieldClass"
            [required]="true">
            <input type="text" class="form-control"  [placeholder]="'page.cloud_stores.content.accounts.add.name.placeholder' | translate"
                   qe-attr="add-cloud-store-credential-name" formField formControlName="credentialName" maxlength="32"/>
            <dlm-field-error *ngIf="addCloudForm.get('credentialName').hasError('uniqValidator')">
              {{'forms.validation_errors.credValidator' | translate}}
            </dlm-field-error>
          </dlm-form-field>
          <dlm-form-field
            [label]="'page.cloud_stores.content.accounts.add.auth_type.label' | translate"
            [fieldClass]="fieldClass"
            [errorClass]="fieldClass"
            [inlineError]="true">
            <dlm-select-field qe-attr="add-cloud-store-credential-type" [disabled]="authTypeDisabled" formField formControlName="authType"
                              [options]="authenticationTypeOptions" [value]="authType">
            </dlm-select-field>
          </dlm-form-field>
          <dlm-form-field *ngIf="isS3AccessKeyAuthType"
            [label]="'page.cloud_stores.content.accounts.add.access_key.label' | translate"
            [inlineError]="true"
            [fieldClass]="fieldClass"
            [errorClass]="fieldClass"
            [required]="true">
            <input type="text" class="form-control" [placeholder]="'page.cloud_stores.content.accounts.add.access_key.placeholder' | translate"
                   [attr.disabled]="isInputDisabled()" qe-attr="cloud-store-access-key" formField formControlName="accessKey" />
            <span *ngIf="isValidationSuccess" class="glyphicon glyphicon-ok text-success status-icon form-control-feedback"></span>
            <span *ngIf="addCloudForm.get('accessKey').hasError('wrongCredentials')" class="glyphicon glyphicon-remove status-icon form-control-feedback"></span>
            <dlm-field-error *ngIf="addCloudForm.get('accessKey').hasError('wrongCredentials')">
              {{'forms.validation_errors.invalid_credentials' | translate}}
            </dlm-field-error>
          </dlm-form-field>
          <dlm-form-field *ngIf="isS3AccessKeyAuthType"
            [label]="'page.cloud_stores.content.accounts.add.secret_key.label' | translate"
            [fieldClass]="fieldClass"
            [errorClass]="fieldClass"
            [inlineError]="true"
            [required]="true">
            <div class="row">
              <div class="col-md-9">
                <input
                  class="form-control"
                  [type]="secretKeyInputType"
                  [placeholder]="'page.cloud_stores.content.accounts.add.secret_key.placeholder' | translate"
                  [attr.disabled]="isInputDisabled()"
                  qe-attr="cloud-store-secret-key"
                  formField
                  formControlName="secretKey"/>
                <span *ngIf="isValidationSuccess"
                      class="glyphicon glyphicon-ok text-success status-icon form-control-feedback"></span>
                <span *ngIf="addCloudForm.get('secretKey').hasError('wrongCredentials')"
                      class="glyphicon glyphicon-remove status-icon form-control-feedback"></span>
              </div>
              <div class="col-md-3">
                <button class="btn btn-default pull-right" type="button" (click)="toggleSecretKeyInputType()"><i class="fa fa-eye"></i></button>
              </div>
            </div>
            <dlm-field-error *ngIf="addCloudForm.get('secretKey').hasError('wrongCredentials')">
              {{'forms.validation_errors.invalid_credentials' | translate}}
            </dlm-field-error>
          </dlm-form-field>
          <div *ngIf="isValidationSuccess">
            <dlm-form-field
              [fieldClass]="fieldClass"
              [errorClass]="fieldClass"
              [label]="'page.cloud_stores.content.accounts.iam_username' | translate">
              <input type="hidden" qe-attr="add_cloud_username_input" formField formControlName="userName" />
              <span qe-attr="add_cloud_username">{{addCloudForm.get('userName').value}}</span>
            </dlm-form-field>
            <dlm-form-field
              [fieldClass]="fieldClass"
              [errorClass]="fieldClass"
              [label]="'page.cloud_stores.content.accounts.aws_account_id' | translate">
              <input type="hidden" qe-attr="add_cloud_account_id_input" formField formControlName="accountId" />
              <span qe-attr="add_cloud_account_id">{{addCloudForm.get('accountId').value}}</span>
            </dlm-form-field>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="form-footer col-xs-12">
          <div class="footer-controls pull-right">
            <button qe-attr="cancel-add-cloud-form" type="button"
                    class="btn btn-default"
                    (click)="cancelButtonHandler()">
              {{'common.cancel' | translate}}
            </button>
            <button *ngIf="!(isValidationSuccess || isIamRoleAuthType)"
                    qe-attr="validate-cloud-connection-btn"
                    type="button"
                    [disabled]="isValidationInProgress || !canValidate"
                    class="btn btn-success"
                    (click)="validateButtonHandler(addCloudForm)">
              <span *ngIf="!isValidationInProgress; else validating;">
                {{'page.cloud_stores.content.accounts.add.validate' | translate}}
              </span>
            </button>
            <button *ngIf="isValidationSuccess || isIamRoleAuthType"
                    qe-attr="save-cloud-btn"
                    type="submit"
                    [disabled]="isSaveButtonDisabled"
                    class="btn btn-success"
                    (click)="saveButtonHandler()">
              <span *ngIf="!isSaveInProgress; else saving;">
                {{'common.save' | translate}}
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
<ng-template #validating>
  <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>{{'page.cloud_stores.content.accounts.add.validating' | translate}}
</ng-template>
<ng-template #saving>
  <i class="fa fa-spinner fa-spin" aria-hidden="true"></i>{{'common.saving' | translate}}
</ng-template>
