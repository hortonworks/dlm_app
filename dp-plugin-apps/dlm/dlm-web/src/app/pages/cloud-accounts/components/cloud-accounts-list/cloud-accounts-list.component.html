<!--
  ~ Copyright  (c) 2016-2017, Hortonworks Inc.  All rights reserved.
  ~
  ~ Except as expressly permitted in a written agreement between you or your company
  ~ and Hortonworks, Inc. or an authorized affiliate or partner thereof, any use,
  ~ reproduction, modification, redistribution, sharing, lending or other exploitation
  ~ of all or any part of the contents of this software is strictly prohibited.
  -->

<dlm-table
  [theme]="tableTheme"
  [columns]="columns"
  [columnMode]="columnMode"
  [footerHeight]="footerHeight"
  [showFooter]="showFooter"
  [limit]="1000"
  [rows]="accounts"
  [rowDetailHeight]="rowDetailHeight"
  [rowClass]="rowClass"
  [rowDetailTemplate]="rowDetailRef">
</dlm-table>

<ng-template #statusCell let-account="row">
  <i *ngIf="hasError(account)" class="fa fa-2x fa-exclamation-triangle text-danger"></i>
</ng-template>

<ng-template #providerCell let-account="row" let-index="rowIndex">
  <div>
    <span class="provider" [attr.qe-attr]="'cloud-account-provider-' + index">{{account.accountDetails.provider}}</span>
    <span class="left-arrow">&#9664;</span>
  </div>
</ng-template>

<ng-template #policiesCell let-account="row" let-index="rowIndex">
  <div [attr.qe-attr]="'cloud-account-policies' + index" class="is-text-large">
    <span *ngIf="account.policies?.length; else noPolicies" class="actionable" (click)="toggleRowDetails(account)">
      {{account.policies.length}}
      <span [ngClass]="{'text-primary': true, 'fa': true, 'fa-chevron-up': isAccountActive(account), 'fa-chevron-down': !isAccountActive(account)}">
      </span>
    </span>
    <ng-template #noPolicies>
      <span class="fa fa-minus"></span>
    </ng-template>
  </div>
</ng-template>

<ng-template #nameCell let-account="row" let-index="rowIndex">
  <div class="userName is-text-large"
    [tooltip]="errorMessage(account)"
    [attr.qe-attr]="'cloud-account-id-' + index">
    {{account.id}}
  </div>
  <div class="userDetails">
    <span
      class="iamRole"
      [attr.qe-attr]="'cloud-account-account-iamRole-' + index"
      *ngIf="account.accountDetails.credentialType === IAM_ROLE">
      {{'page.cloud_stores.content.accounts.iam_role' | translate}}
    </span>
    <span
      class="userName"
      [attr.qe-attr]="'cloud-account-account-userName-' + index"
      [tooltip]="('page.cloud_stores.content.accounts.iam_username' | translate)"
      *ngIf="account.accountDetails.userName">
      {{account.accountDetails.userName}}
    </span>
    <span
      class="accountName"
      [attr.qe-attr]="'cloud-account-account-name-' + index"
      [tooltip]="('page.cloud_stores.content.accounts.aws_account_id' | translate)"
      *ngIf="account.accountDetails.accountName">
      | {{account.accountDetails.accountName}}
    </span>
  </div>
  <div *ngIf="isExpiredAccount(account); else outOfSync">
    <button type="button" class="btn btn-secondary btn-xs" (click)="edit(account)">
      {{'common.edit' | translate}}
    </button>
  </div>
  <ng-template #outOfSync>
    <div *ngIf="isOutOfSync(account)">
      <button type="button" class="btn btn-secondary btn-xs" (click)="sync(account)">
        {{'common.sync' | translate}}
      </button>
    </div>
  </ng-template>
</ng-template>

<ng-template #actionsCell let-account="row" let-index="rowIndex">
  <dlm-cloud-account-actions *ngIf="!isUnregistered(account); else deleteAccount"
    [attr.qe-attr]="'cloud-account-actions-' + index"
    [rowId]="account.id"
    [cloudAccount]="account"
    [cloudAccountActions]="cloudAccountActions"
    (handler)="handleSelectedAction($event)">
  </dlm-cloud-account-actions>
  <ng-template #deleteAccount>
    <i class="fa fa-trash fa-2x text-primary actionable" (click)="deleteUnregistered(account)"></i>
  </ng-template>
</ng-template>

<ng-template let-account="row" ngx-datatable-row-detail-template #rowDetailRef>
  <dlm-cloud-account-policies-table [policies]="account.policies"></dlm-cloud-account-policies-table>
</ng-template>
