<!--
  ~ Copyright  (c) 2016-2017, Hortonworks Inc.  All rights reserved.
  ~
  ~ Except as expressly permitted in a written agreement between you or your company
  ~ and Hortonworks, Inc. or an authorized affiliate or partner thereof, any use,
  ~ reproduction, modification, redistribution, sharing, lending or other exploitation
  ~ of all or any part of the contents of this software is strictly prohibited.
  -->

<dlm-table
  [theme]="tableTheme"
  [columns]="columns"
  [columnMode]="columnMode"
  [footerHeight]="footerHeight"
  [showFooter]="showFooter"
  [limit]="1000"
  [rows]="accounts"
  [rowDetailHeight]="rowDetailHeight"
  [rowDetailTemplate]="rowDetailRef">
</dlm-table>

<ng-template #providerCell let-account="row" let-index="rowIndex">
  <div>
    <span class="provider" [attr.qe-attr]="'cloud-account-provider-' + index">{{account.accountDetails.provider}}</span>
    <span class="left-arrow">&#9664;</span>
  </div>
</ng-template>

<ng-template #policiesCell let-account="row" let-index="rowIndex">
  <div [attr.qe-attr]="'cloud-account-policies' + index" class="is-text-large">
    <span *ngIf="account.policies?.length; else noPolicies" class="actionable" (click)="toggleRowDetails(account)">
      {{account.policies.length}}
      <span [ngClass]="{'text-primary': true, 'fa': true, 'fa-chevron-up': isAccountActive(account), 'fa-chevron-down': !isAccountActive(account)}">
      </span>
    </span>
    <ng-template #noPolicies>
      <span class="fa fa-minus"></span>
    </ng-template>
  </div>
</ng-template>

<ng-template #nameCell let-account="row" let-index="rowIndex">
  <ng-template #accountTemplate>
        <span *ngIf="account.accountDetails.credentialType === S3_TOKEN; else iamRole">
       {{account.accountDetails.userName}}<br>{{account.accountDetails.accountName}}
     </span>
    <ng-template #iamRole>
      {{'page.cloud_stores.content.accounts.iam_role' | translate}}<br>{{account.accountDetails.accountName}}
    </ng-template>
  </ng-template>
  <div
    class="userName is-text-large"
    [tooltip]="accountTemplate"
    [attr.qe-attr]="'cloud-account-id-' + index">
    {{account.id}}
  </div>
  <div class="userDetails">
    <span
      class="userName"
      [attr.qe-attr]="'cloud-account-account-userName-' + index"
      [tooltip]="accountTemplate"
      *ngIf="account.accountDetails.userName">
      {{account.accountDetails.userName}}
    </span>
    <span
      class="accountName"
      [attr.qe-attr]="'cloud-account-account-name-' + index"
      *ngIf="account.accountDetails.accountName">
      | {{account.accountDetails.accountName}}
    </span>
  </div>
</ng-template>

<ng-template #actionsCell let-account="row" let-index="rowIndex">
  <dlm-cloud-account-actions
    [attr.qe-attr]="'cloud-account-actions-' + index"
    [rowId]="account.id"
    [cloudAccount]="account"
    [cloudAccountActions]="cloudAccountActions"
    (handler)="handleSelectedAction($event)">
  </dlm-cloud-account-actions>
</ng-template>

<ng-template let-account="row" ngx-datatable-row-detail-template #rowDetailRef>
  <dlm-cloud-account-policies-table [policies]="account.policies"></dlm-cloud-account-policies-table>
</ng-template>
