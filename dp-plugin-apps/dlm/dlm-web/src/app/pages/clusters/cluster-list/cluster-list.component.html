<!--
  ~ Copyright  (c) 2016-2017, Hortonworks Inc.  All rights reserved.
  ~
  ~ Except as expressly permitted in a written agreement between you or your company
  ~ and Hortonworks, Inc. or an authorized affiliate or partner thereof, any use,
  ~ reproduction, modification, redistribution, sharing, lending or other exploitation
  ~ of all or any part of the contents of this software is strictly prohibited.
  -->

<dlm-table
  [rowDetailHeight]="550"
  [rowDetailTemplate]="rowDetailRef"
  [theme]="tableTheme"
  [columns]="columns"
  [columnMode]="columnMode"
  [footerOptions]="tableFooterOptions"
  [rows]="clusters">
</dlm-table>

<ng-template #statusCell let-status="value" let-cluster="row">
  <span>
    <dlm-cluster-status-icon [cluster]="cluster" [attr.qe-attr]="'cluster-status-icon-' + cluster.$$index" ></dlm-cluster-status-icon>
    <span [innerHtml]="status" [attr.qe-attr]="'cluster-status-' + cluster.$$index" ></span>
  </span>
</ng-template>

<ng-template #slashIconCell>
  <span class="slash">&#47;</span>
</ng-template>

<ng-template #nameCell let-name="value" let-cluster="row">
  <span class="cluster-name" [attr.qe-attr]="'cluster-name-' + cluster.$$index">{{name}}</span>
</ng-template>

<ng-template #dcCell let-name="value" let-cluster="row">
  <span class="datacenter-name" [attr.qe-attr]="'datacenter-name-' + cluster.$$index" >{{name}}</span>
</ng-template>

<ng-template let-stats="value" let-cluster="row" #usageCell let-expanded="expanded">
  <div class="cell-content"
       [ngClass]="setStatsClass(cluster)"
       [tooltip]="getStatsTooltip(cluster)"
       [attr.qe-attr]="'cluster-details-' + cluster.$$index" (click)="toggleClusterDetails(cluster)">
    <span [innerHTML]="getCapacityUsed(stats)"></span> / <span [innerHTML]="getCapacityTotal(stats)"></span>
    <i *ngIf="!isHDFSDisabled(cluster)" [ngClass]="{fa: true, 'fa-chevron-down': !expanded, 'fa-chevron-up': expanded}"></i>
  </div>
</ng-template>

<ng-template let-value="value" let-column="column" let-row="row" #plainCell>
  <span *ngIf="value || value === 0; else emptyValue" class="cell-content" [attr.qe-attr]="column['qeAttrName'] + '-' + row.$$index">{{value}}</span>
  <ng-template #emptyValue>
    <span [attr.qe-attr]="column['qeAttrName'] + '-' + row.$$index">
      <i class="fa fa-minus"></i>
    </span>
  </ng-template>
</ng-template>

<ng-template let-location="value" let-cluster="row" #locationCell>
  <span [attr.qe-attr]="'cluster-location-' + cluster.$$index" >{{location.city}}, {{location.country}}</span>
</ng-template>

<ng-template let-cluster="row" #addActionsCell>
  <dlm-cluster-actions
    [attr.qe-attr]="'cluster-actions-' + cluster.$$index"
    [rowId]="cluster.id"
    [cluster]="cluster"
    [clusterActions]="clusterActions"
    [clustersLength]="clusters.length"
    (handler)="handleSelectedAction($event)">
  </dlm-cluster-actions>
</ng-template>

<ng-template let-cluster="row" ngx-datatable-row-detail-template #rowDetailRef>
  <div class="row">
    <div class="col col-xs-12">
      <dlm-hdfs-browser
        [attr.qe-attr]="'cluster-actions-hdfs-browser' + cluster.$$index"
        [rootPath]="hdfsRootPath"
        [clusterId]="cluster.id"
        [page]="getFileBrowserPageForRow(cluster.id)"
        (changePage)="handleFileBrowserPageChange($event, cluster.id)"
        (openDirectory)="handleOpenDirectory($event)"></dlm-hdfs-browser>
    </div>
  </div>
</ng-template>
