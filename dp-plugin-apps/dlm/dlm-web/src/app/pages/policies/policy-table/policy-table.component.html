<dlm-table
  [rowDetailHeight]="550"
  [rowDetailTemplate]="rowDetailRef"
  [theme]="tableTheme"
  [columns]="columns"
  [rows]="policies">
</dlm-table>

<dlm-icon-column></dlm-icon-column>
<dlm-status-column></dlm-status-column>
<dlm-policy-info (nameClick)="toggleRowDetail($event, policyContent.Files)"></dlm-policy-info>
<dlm-flow-status></dlm-flow-status>

<ng-template #durationCell let-seconds="value">
  {{seconds ? (seconds | amUtc | amDateFormat:'HH:mm:ss') : 'Running'}}
</ng-template>

<ng-template #iconCellTemplate>
  <span class="fa fa-arrow-right" aria-hidden="true"></span>
</ng-template>

<ng-template #scheduleCellTemplate let-value="value">
  <span>{{value | frequency}}</span>
</ng-template>

<ng-template #prevJobs let-row="row">
  <span class="actionable text-primary" (click)="toggleRowDetail(row, policyContent.Jobs)">
    <i class="fa fa-circle"></i>
    <i class="fa fa-circle"></i>
    <i class="fa fa-circle"></i>
    <span class="caret"></span>
  </span>
</ng-template>

<ng-template #lastGoodCell let-time="value">
  <span *ngIf="time; else noData" [tooltip]="time | fmtTz | amDateFormat:'YYYY-MMM-DD, HH:mm:ss'">
    {{time | fmtTz | amTimeAgo}}
  </span>
  <ng-template #noData>
    n/a
  </ng-template>
</ng-template>

<ng-template #dataCell let-size="value" let-row="row">
  <span class="actionable text-primary" (click)="toggleRowDetail(row, policyContent.Files)">
    <span [innerHTML]="size|bytesSize"></span>
    <span class="caret"></span>
  </span>
</ng-template>

<ng-template let-row="row" ngx-datatable-row-detail-template #rowDetailRef>
  <dlm-policy-details [contentType]="activeContentType" [policy]="row" [jobs]="filteredJobs$ | async" [sourceCluster]="sourceCluster" [hdfsRootPath]="hdfsRootPath"></dlm-policy-details>
</ng-template>

<ng-template let-row="row" let-value="value" #pathCell>
  <span [tooltip]="value">{{value | truncate:15}}</span>
</ng-template>

<ng-template #actionsCell let-row="row">
  <div class="btn-group" dropdown placement="bottom right">
    <button dropdownToggle class="btn btn-link">
      <i class="fa fa-ellipsis-v text-primary"></i>
    </button>
    <ul *dropdownMenu class="dropdown-menu dropdown-menu-right">
      <li *ngFor="let rowAction of rowActions"
          (click)="handleSelectedAction(row, rowAction)"
          [class.disabled]="row.status === rowAction.disabledFor">
        <a href="javascript:void(0);" class="dropdown-item">{{rowAction.label}}</a>
      </li>
    </ul>
  </div>
</ng-template>

<dlm-modal-dialog
  [title]="'page.policies.perform_action.confirmation.title'"
  [body]="'page.policies.perform_action.confirmation.body'"
  [showDialog]="showActionConfirmationModal"
  (onClose)="onCloseActionConfirmationModal()"
  (onOk)="onActionConfirmation()">
</dlm-modal-dialog>

<dlm-modal-dialog
  [title]="lastOperationResponse.status"
  [body]="lastOperationResponse.message"
  [showDialog]="showOperationResponseModal"
  [showCancel]="false"
  (onClose)="onCloseOperationResponseModal()">
</dlm-modal-dialog>
