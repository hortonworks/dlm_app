<!--
  ~ Copyright  (c) 2016-2017, Hortonworks Inc.  All rights reserved.
  ~
  ~ Except as expressly permitted in a written agreement between you or your company
  ~ and Hortonworks, Inc. or an authorized affiliate or partner thereof, any use,
  ~ reproduction, modification, redistribution, sharing, lending or other exploitation
  ~ of all or any part of the contents of this software is strictly prohibited.
  -->

<div class="form-container">
  <form class="basic-form policy-form" [formGroup]="form">
    <div class="container-fluid">
      <div class="row">
        <fieldset formGroupName="destination">
          <div class="col-xs-12 form-section">
            <!-- DESTINATION TYPE -->
            <div class="row">
              <div class="col-xs-4">
                <dlm-form-field
                  [label]="'page.policies.form.fields.destination_type' | translate"
                  [fieldClass]="'col-xs-12'"
                  [errorClass]=""
                  [required]="true">
                  <dlm-select-field
                    qe-attr="policy-destination-type"
                    formField
                    formControlName="type"
                    [options]="destinationTypes"
                    [value]="destinationType">
                  </dlm-select-field>
                </dlm-form-field>
              </div>
            </div>
            <!-- DESTINATION TYPE END -->

            <!-- DESTINATION CLUSTER -->
            <div class="row">
              <div class="col-xs-4" *ngIf="isClusterType">
                <dlm-form-field
                  [label]="'page.policies.form.fields.destinationCluster.self' | translate"
                  [fieldClass]="'col-xs-12'"
                  [errorClass]=""
                  [required]="true">
                  <dlm-select-field
                    qe-attr="policy-destination-cluster"
                    formField
                    formControlName="cluster"
                    [options]="destinationClusters"
                    [value]="destinationCluster">
                  </dlm-select-field>
                </dlm-form-field>
              </div>
            </div>
            <!-- DESTINATION CLUSTER END -->

            <!-- DESTINATION PATH -->
            <div class="row">
              <div class="col-xs-4" *ngIf="isClusterType && isClusterSelected">
                <dlm-form-field
                  [label]="destinationPathLabel"
                  [fieldClass]="'col-xs-12'"
                  [errorClass]="'col-xs-12'"
                  [required]="true">
                  <input
                    qe-attr="policy-destination-path"
                    formField
                    class="form-control"
                    formControlName="path">
                  <dlm-field-error *ngIf="form.get('destination.path').hasError('encryption')">
                    {{'page.policies.form.fields.destinationCluster.errors.encryption' | translate}}
                  </dlm-field-error>
                </dlm-form-field>
              </div>
            </div>
            <!-- DESTINATION PATH END -->

            <!-- DESTINATION TDE KEY -->
            <div class="row" *ngIf="isSourceEncrypted && isClusterSelected && isClusterType">
              <div class="col-xs-4">
                <dlm-form-field
                  [label]="'page.policies.form.fields.destinationCluster.tdeKey' | translate"
                  [fieldClass]="'col-xs-12'"
                  [errorClass]="'col-xs-12'">
                  <dlm-radio-button qe-attr="policy-destination-tde-type"
                    formField
                    [items]="tdeOptions"
                    formControlName="tdeKey">
                  </dlm-radio-button>
                </dlm-form-field>
              </div>
            </div>
            <!-- DESTINATION TDE KEY END -->

            <!-- DESTINATION CLOUD ACCOUNT -->
            <div class="row">
              <div class="col-xs-4" *ngIf="form.get('destination.type').value === SOURCE_TYPES.S3">
                <dlm-form-field
                  [label]="'page.policies.form.fields.s3.account' | translate"
                  [required]="true"
                  [fieldClass]="'col-xs-12'"
                  [errorClass]="">
                  <dlm-select-field
                    qe-attr="destination-cloud-account"
                    formField
                    formControlName="cloudAccount"
                    [options]="destinationCloudAccounts"
                    [value]="destinationCloudAccount">
                  </dlm-select-field>
                </dlm-form-field>
              </div>
            </div>
            <!-- DESTINATION CLOUD ACCOUNT END -->

            <div class="row" *ngIf="shouldShowTDEWarning">
              <div class="col-xs-4">
                <div class="alert alert-warning alert-small flex-center">
                  <div class="pull-left">
                    <i class="fa fa-exclamation-triangle text-warning"></i>
                  </div>
                  <div class="pull-left mlm">
                    <div>{{'page.policies.form.fields.destinationCluster.tde_warning.title' | translate}}</div>
                    <small>{{'page.policies.form.fields.destinationCluster.tde_warning.body' | translate}}</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- DESTINATION S3 ENDPOINT -->
            <div class="row">
              <div class="col-xs-4" *ngIf="form.get('destination.cloudAccount').value && form.get('destination.type').value === SOURCE_TYPES.S3">
                <dlm-form-field
                  [label]="'page.policies.form.fields.s3.endpoint' | translate"
                  [errorClass]="'col-xs-12'"
                  [fieldClass]="'col-xs-12'"
                  [required]="true">
                  <div class="input-group">
                    <div class="input-group-addon">{{SOURCE_TYPES_LABELS[SOURCE_TYPES.S3]}}://</div>
                    <input
                      type="text"
                      class="form-control"
                      qe-attr="destinationS3endpoint"
                      formField
                      formControlName="s3endpoint"/>
                  </div>
                </dlm-form-field>
                <button type="button" class="btn btn-success pull-right">{{"page.policies.form.validateBtn" | translate}}</button>
              </div>
            </div>
            <!-- DESTINATION S3 ENDPOINT END -->
          </div>
          <div class="row" *ngIf="showValidation">
            <div class="col-xs-12">
              <dlm-checkbox (onSelect)="handleSkipValidation($event)">
                {{'page.policies.form.fields.destinationCluster.skipValidation' | translate}}
              </dlm-checkbox>
              <button
                [disabled]="form.get('destination.skipValidation').value || validationInProgress"
                type="button"
                class="btn btn-success"
                (click)="validate()">
                &nbsp;{{"page.policies.form.validateBtn" | translate}} <i *ngIf="validationInProgress" class="fa fa-fw fa-spinner fa-spin"></i>
                <i class="glyphicon glyphicon-ok" *ngIf="form.get('destination.validationStatus').value && !validationInProgress"></i>
              </button>
              <div *ngIf="form.get('destination.validationPerformed').value && !form.get('destination.skipValidation').value && !validationInProgress">
                <div *ngIf="!form.get('destination.validationStatus').value">
                  <dlm-field-error>{{"page.policies.form.fields.destinationCluster.validationFailed" | translate}}</dlm-field-error>
                </div>
              </div>
            </div>
          </div>
        </fieldset>
      </div>
    </div>
  </form>
</div>
