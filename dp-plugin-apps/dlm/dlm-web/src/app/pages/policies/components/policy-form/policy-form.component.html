<div class="form-container">
  <form class="basic-form" [formGroup]="policyForm" (ngSubmit)="handleSubmit(policyForm)">
    <div class="container-fluid">
      <div class="row">
        <div class="form-section col-md-12">
          <div class="form-section-title">
            {{'page.policies.form.sections.general' | translate}}
            <div class="pull-right">
              <i class="fa text-primary"
                [ngClass]="{'fa-chevron-down': sectionCollapsedMap.general, 'fa-chevron-up': !sectionCollapsedMap.general}"
                (click)="toggleSection('general')"></i>
            </div>
            <div class="clearfix"></div>
          </div>
          <fieldset formGroupName="general" [collapse]="sectionCollapsedMap.general">
            <dlm-form-field
              [label]="'page.policies.form.fields.policy_name' | translate">
              <input type="text" class="form-control" formField formControlName="name"/>
            </dlm-form-field>
            <div class="form-group">
              <div class="row">
                <label class="col-md-6">
                  {{'page.policies.form.fields.service' | translate}}
                </label>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <dlm-radio-button [items]="storageTypes" formControlName="type" (change)="handlePolicyTypeChange($event)"></dlm-radio-button>
                </div>
              </div>
            </div>
            <dlm-form-field [label]="'page.policies.form.fields.pairs' | translate">
              <dlm-select-field formField formControlName="pair" [options]="pairs" (onSelect)="handlePairChange($event)">
                <ng-template selectFieldValue selectFieldOption let-value="value" let-label="label">
                  <div *ngIf="!value">{{label}}</div>
                  <div *ngIf="value" class="actionable">
                    {{label[0]}}
                    <i class="glyphicon glyphicon-resize-horizontal"></i>
                    {{label[1]}}
                   </div>
                </ng-template>
              </dlm-select-field>
            </dlm-form-field>
            <dlm-form-field *ngIf="clustersFromPair.length > 0" [label]="'page.policies.form.fields.sourceCluster.self' | translate">
              <dlm-select-field formField formControlName="sourceCluster" [options]="clustersFromPair" (onSelect)="handleSourceClusterChange($event)">
              </dlm-select-field>
            </dlm-form-field>
          </fieldset>
        </div>
      </div>

      <div class="row" *ngIf="isHDFSPolicy() && sourceCluster">
        <div class="form-section col-md-10">
          <div class="form-section-title">
            {{'page.policies.form.sections.directories' | translate}}
            <div class="pull-right">
              <i class="fa text-primary"
                [ngClass]="{'fa-chevron-down': sectionCollapsedMap.directories, 'fa-chevron-up': !sectionCollapsedMap.directories}"
                (click)="toggleSection('directories')"></i>
            </div>
            <div class="clearfix"></div>
          </div>
          <div class="row" [collapse]="sectionCollapsedMap.directories">
            <div class="col-md-12">
              <dlm-form-field [label]="'page.policies.form.fields.directories' | translate">
                <input type="text" formField class="form-control" formControlName="directories" [(ngModel)]="selectedHdfsPath"/>
              </dlm-form-field>
              <dlm-hdfs-browser [rootPath]="hdfsRootPath" [clusterId]="sourceCluster" (select)="handleHdfsPathChange($event)"></dlm-hdfs-browser>
            </div>
          </div>
        </div>
      </div>

      <div class="row" *ngIf="isHivePolicy()">
        <div class="form-section col-md-10">
          <div class="form-section-title">
            {{'page.policies.form.sections.database' | translate}}
            <div class="pull-right">
              <i class="fa text-primary"
                [ngClass]="{'fa-chevron-down': sectionCollapsedMap.database, 'fa-chevron-up': !sectionCollapsedMap.database}"
                (click)="toggleSection('database')"></i>
            </div>
            <div class="clearfix"></div>
          </div>
          <div class="form-group" [collapse]="sectionCollapsedMap.database">
            <div class="row flex-center">
              <div class="col-md-8">
                <span class="text-muted">
                  {{'page.policies.form.selected' | translate}}: {{policyForm.value.databases?.length}}
                </span>
              </div>
              <div class="col-md-4">
                <dlm-search-input (change)="handleSearchChange($event)"></dlm-search-input>
              </div>
            </div>
            <dlm-checkbox-list [items]="visibleDbList" formControlName="databases"></dlm-checkbox-list>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="form-section col-md-6">
          <div class="form-section-title">
            {{'page.policies.form.sections.job' | translate}}
            <div class="pull-right">
              <i class="fa text-primary"
                [ngClass]="{'fa-chevron-down': sectionCollapsedMap.job, 'fa-chevron-up': !sectionCollapsedMap.job}"
                (click)="toggleSection('job')"></i>
            </div>
            <div class="clearfix"></div>
          </div>
          <div [collapse]="sectionCollapsedMap.job" formGroupName="job">
            <dlm-radio-button
              formControlName="schedule"
              [items]="jobTypes"
              [selectedValue]="selectedJobType"
              (change)="handleJobChange($event)">
            </dlm-radio-button>
            <div class="clearfix"></div>
            <div class="form-group" *ngIf="isScheduled()">
              <div class="schedule-group">
                <tabset>
                  <tab *ngFor="let tab of scheduleTabs" (select)="handleJobTabChange(tab)" [heading]="tab.title | translate">
                    <div class="row">
                      <div class="col-md-6" formGroupName="startTime">
                        <div class="date-time-group">
                          <div class="date-control">
                            <my-date-picker
                              selectionTxtFontSize="12"
                              [selDate]="policyForm.value.job.startTime.date"
                              [placeholder]="'page.policies.form.fields.start_time' | translate"
                              [options]="datePickerOptions"
                              (dateChanged)="handleDateChange($event, 'startTime')">
                            </my-date-picker>
                          </div>
                          <dlm-form-field fieldClass="col-md-12" errorClass="col-md-12">
                            <div class="time-control">
                              <div class="clock-icon">
                                <i class="fa fa-clock-o"></i>
                              </div>
                              <timepicker formField formControlName="time" [showMeridian]="false"></timepicker>
                            </div>
                            <dlm-field-error *ngIf="policyForm.controls.job.controls.startTime.controls.time.hasError('lessThanCurrent')">
                              {{'forms.validation_errors.time_less_than_current' | translate}}
                            </dlm-field-error>
                          </dlm-form-field>
                        </div>
                      </div>
                      <div class="col-md-6" formGroupName="endTime">
                        <div class="date-time-group">
                          <div class="date-control">
                            <my-date-picker
                              [selDate]="policyForm.value.job.endTime.date"
                              [placeholder]="'page.policies.form.fields.end_time' | translate"
                              (dateChanged)="handleDateChange($event, 'endTime')"
                              [options]="datePickerOptions">
                            </my-date-picker>
                          </div>
                          <dlm-form-field fieldClass="col-md-12" errorClass="col-md-12">
                            <div class="time-control">
                              <div class="clock-icon">
                                <i class="fa fa-clock-o"></i>
                              </div>
                              <timepicker formField formControlName="time" [showMeridian]="false"></timepicker>
                            </div>
                            <dlm-field-error *ngIf="policyForm.controls.job.controls.endTime.controls.time.hasError('lessThanCurrent')">
                              {{'forms.validation_errors.time_less_than_current' | translate}}
                            </dlm-field-error>
                          </dlm-form-field>
                        </div>
                      </div>
                    </div>
                  </tab>
                </tabset>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-footer col-md-12">
          <div class="footer-controls pull-right">
            <button type="button" class="btn btn-default" (click)="cancel()">
              {{'common.cancel' | translate}}
            </button>
            <button class="btn btn-success" type="submit">
              {{'common.review' | translate}}
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
